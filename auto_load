#Filename :auto_load
#Author   :Ji Bo
#Time     :2016-02-12 
#Funtction:Automically,install module,create the proper device and set the 
# 	   read /write bits appropriately

module="virtualchar"
device="virtualchar"  #The device name and the module name may be same or not . 
mode="666"
number=1     #number-1
#删除原有节点
rm -f  /dev/${device}[0-$number]
#先卸载，在加载模块
/sbin/rmmod $module

/sbin/insmod ./$module.ko

major=$(cat /proc/devices |grep ${device} |awk '{printf $1}')
echo Using major number $major

for i in [0-$number]
do
	echo "create" $major $i
	mknod /dev/${device}$i c $major $i
done

chmod $mode /dev/${device}[0-$number]
